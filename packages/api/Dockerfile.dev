# Development Dockerfile for API server
FROM node:20-slim

WORKDIR /app

# Install pnpm
RUN corepack enable && corepack prepare pnpm@9.15.0 --activate

# Copy package files
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml* ./
COPY packages/shared/package.json packages/shared/
COPY packages/api/package.json packages/api/
COPY packages/builder/package.json packages/builder/

# Install dependencies
RUN pnpm install

# Copy source
COPY tsconfig.base.json ./
COPY packages/shared packages/shared/
COPY packages/api packages/api/
COPY packages/builder packages/builder/

# Build packages
RUN pnpm --filter @lazykitty/shared build
RUN pnpm --filter @lazykitty/builder build
RUN pnpm --filter @lazykitty/api build

# Expose port
EXPOSE 3000

# Start server
CMD ["pnpm", "--filter", "@lazykitty/api", "start"]
